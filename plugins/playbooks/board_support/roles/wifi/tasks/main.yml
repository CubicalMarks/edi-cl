---
- name: Load project specific (customized) wifi configuration.
  include_vars: "{{ item }}"
  with_first_found:
    - "{{ wifi_config_directory }}/wifi_custom.yml"
    - "{{ wifi_config_directory }}/wifi.yml"

- name: Install the firmware for the AX200 (iwlwifi) from buster-backports.
  apt:
    name: firmware-iwlwifi
    default_release: buster-backports

- name: Install wifi related apt packages.
  apt:
    name: "{{ packages }}"
  vars:
    packages:
    - wireless-tools
    - wpasupplicant

- name: Preset redundant wpa_supplicant services to disabled.
  copy:
    src: 95-wpa_supplicant.preset
    dest: /lib/systemd/system-preset/

- name: Setup wpa supplicant.
  template:
    src: wpa_supplicant.conf
    dest: /etc/wpa_supplicant/

- name: Setup wlan0 interface.
  copy:
    src: wlan0
    dest: /etc/network/interfaces.d/

